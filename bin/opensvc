#!/bin/sh

# variables users can override in the defaults file
OSVC_ROOT_PATH="/usr/share/opensvc"
OSVC_PYTHON="python"
OSVC_PYTHON_ARGS=""

if [ -e "/etc/defaults/opensvc" ]
then
	# FreeBSD, Darwin
	. "/etc/defaults/opensvc"
elif [ -e "/etc/default/opensvc" ]
then
	# Debian-like, Tru64, SunOS and HP-UX
	. "/etc/default/opensvc"
elif [ -e "/etc/sysconfig/opensvc" ]
then
	# Red Hat-like
	. "/etc/sysconfig/opensvc"
elif [ -e "/etc/rc.config.d/opensvc" ]
then
	# AIX
	. "/etc/rc.config.d/opensvc"
fi

BASENAME=`basename $0`

case $BASENAME in
*.cluster)
	BIN_ARGS="$BIN_ARGS --cluster"
	BASENAME=`echo $BASENAME|sed -e "s/.cluster$//"`
	;;
*.stonith)
	BIN_ARGS="$BIN_ARGS stonith --cluster"
	BASENAME=`echo $BASENAME|sed -e "s/.stonith$//"`
	;;
esac

if [ "$BASENAME" = "nodemgr" -o "$BASENAME" = "svcmgr" -o "$BASENAME" = "svcmon" ]
then
	BIN="$OSVC_ROOT_PATH/lib/$BASENAME.py"
else
	# exec from a service link: add the --service parameter
	BIN="$OSVC_ROOT_PATH/lib/svcmgr.py"
	BIN_ARGS="$BIN_ARGS --service $BASENAME"
fi

"$OSVC_PYTHON" $OSVC_PYTHON_ARGS "$BIN" $BIN_ARGS "$@"


#!/bin/bash

PATH_SCRIPT="$(cd $(/usr/bin/dirname $(type -p -- $0 || echo $0));pwd)"
. $PATH_SCRIPT/make.lib

prepare_chroot || exit 1

SPEC=$OSVC/tmp/SPECS/opensvc.spec

cat - <<-EOF >$SPEC
Summary: OpenSVC node tools
Name: opensvc
Version: $VERSION
Release: $RELEASE
License: GPLv2
Group: Administration/Tools
BuildRoot: $CHROOT
Requires: /usr/bin/python2.6

%description
These are the tools to drive OpenSVC services
%post
/opt/opensvc/bin/postinstall
%files
%docdir /opt/opensvc/usr/share
%defattr(-,root,root)
%attr(0755,root,root) /opt/opensvc/bin
/opt/opensvc/lib
/opt/opensvc/etc
/opt/opensvc/log
/opt/opensvc/tmp
/opt/opensvc/var
/opt/opensvc/usr

#%changelog
#\$(changelog)
EOF

sudo rpmbuild --target=noarch --define "_topdir $OSVC/tmp" --clean -bb $SPEC

[ -x $PATH_SCRIPT/release_rpm ] && $PATH_SCRIPT/release_rpm $OSVC/tmp/RPMS/noarch/opensvc-$VERSION-$RELEASE.noarch.rpm
